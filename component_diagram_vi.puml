@startuml Sơ Đồ Thành Phần

!define RECTANGLE class

skinparam component {
    BackgroundColor<<frontend>> LightBlue
    BackgroundColor<<backend>> LightGreen
    BackgroundColor<<library>> LightYellow
    BackgroundColor<<external>> LightCoral
    BorderColor Black
}

package "Giao Diện (Trình duyệt)" <<frontend>> {
    [Giao diện Web] as UI
    [Mẫu HTML] as HTML
    [Kiểu CSS] as CSS
    [JavaScript] as JS
}

package "Máy Chủ (Flask Server)" <<backend>> {
    [Ứng dụng Flask] as Flask
    [Xử lý Route] as Routes
    [API Endpoints] as API
    [Quản lý File] as FileManager
}

package "Logic Nghiệp Vụ" <<backend>> {
    component "Module Biển Số" {
        [Bộ phát hiện YOLO] as YOLO
        [Công cụ OCR] as OCR
        [Tiền xử lý] as Preproc
        [Kiểm tra hợp lệ] as Validator
    }
    
    component "Module DICOM" {
        [Đọc DICOM] as DICOMReader
        [Điều chỉnh cửa sổ] as Window
        [Tăng cường] as Enhance
    }
}

package "Thư Viện Cơ Bản" <<library>> {
    [config.py] as Config
    [utils.py] as Utils
    [OpenCV] as OpenCV
    [EasyOCR] as EasyOCR
    [NumPy] as NumPy
    [Pillow] as Pillow
}

package "Thư Viện Bên Ngoài" <<external>> {
    [Ultralytics YOLO] as YOLOLib
    [pydicom] as pydicomLib
    [PyTorch] as PyTorch
}

database "Hệ Thống File" {
    folder "uploads/" as Uploads
    folder "runs/" as Runs
    folder "dicom_samples/" as Samples
}

' Kết nối Giao diện
UI --> HTML
UI --> CSS
UI --> JS

' Giao diện đến Máy chủ
UI --> Flask : HTTP/HTTPS

' Máy chủ nội bộ
Flask --> Routes
Flask --> API
Flask --> FileManager

' Máy chủ đến Logic nghiệp vụ
API --> YOLO : phát hiện biển số
API --> DICOMReader : xử lý DICOM

' Logic nghiệp vụ nội bộ - Biển số
YOLO --> Preproc
Preproc --> OCR
OCR --> Validator

' Logic nghiệp vụ nội bộ - DICOM
DICOMReader --> Window
Window --> Enhance

' Logic nghiệp vụ đến Thư viện cơ bản
YOLO --> Config
YOLO --> OpenCV
YOLO --> Utils

OCR --> EasyOCR
OCR --> Config
OCR --> Utils

Preproc --> OpenCV
Preproc --> NumPy
Preproc --> Config

Validator --> Utils
Validator --> Config

DICOMReader --> pydicomLib
DICOMReader --> NumPy
DICOMReader --> Pillow

Window --> NumPy
Enhance --> OpenCV

' Cơ bản đến Bên ngoài
YOLO --> YOLOLib
EasyOCR --> PyTorch

' Kết nối Hệ thống file
FileManager --> Uploads : đọc/ghi
YOLO --> Runs : tải mô hình
DICOMReader --> Samples : đọc mẫu

note right of UI
  Giao diện người dùng
  - Tải file lên
  - Hiển thị kết quả
  - Điều chỉnh cài đặt
end note

note right of API
  REST API
  - /api/detect-plate
  - /api/process-dicom
  - /api/adjust-window
end note

note right of YOLO
  Quy trình phát hiện
  1. Phát hiện YOLO
  2. Dự phòng OpenCV
  3. Trích xuất ROI
end note

note right of OCR
  Quy trình nhận dạng
  1. Tiền xử lý (20 biến thể)
  2. Nhận dạng EasyOCR
  3. Bỏ phiếu kết quả tốt nhất
  4. Kiểm tra hợp lệ
end note

note right of DICOMReader
  Quy trình DICOM
  1. Đọc file DICOM
  2. Trích xuất siêu dữ liệu
  3. Áp dụng windowing
  4. Tăng cường ảnh
end note

@enduml
